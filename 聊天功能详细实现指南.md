# èŠå¤©åŠŸèƒ½è¯¦ç»†å®ç°æŒ‡å—

## ç›®å½•

1. [ç®€ä»‹](#ç®€ä»‹)
2. [ç¯å¢ƒå‡†å¤‡](#ç¯å¢ƒå‡†å¤‡)
3. [é¡¹ç›®ç»“æ„æ­å»º](#é¡¹ç›®ç»“æ„æ­å»º)
4. [æ ¸å¿ƒç»„ä»¶å®ç°](#æ ¸å¿ƒç»„ä»¶å®ç°)
   - [ä¸»ç»„ä»¶ index.vue](#ä¸»ç»„ä»¶-indexvue)
   - [å¤´éƒ¨ç»„ä»¶ ChatHeader.vue](#å¤´éƒ¨ç»„ä»¶-chatheadervue)
   - [æ¶ˆæ¯åˆ—è¡¨ç»„ä»¶ ChatMessages.vue](#æ¶ˆæ¯åˆ—è¡¨ç»„ä»¶-chatmessagesvue)
   - [è¾“å…¥ç»„ä»¶ ChatInput.vue](#è¾“å…¥ç»„ä»¶-chatinputvue)
5. [AI é›†æˆå®ç°](#ai-é›†æˆå®ç°)
6. [åŠŸèƒ½ç‰¹æ€§è¯¦è§£](#åŠŸèƒ½ç‰¹æ€§è¯¦è§£)
   - [æµå¼è¾“å‡ºå®ç°](#æµå¼è¾“å‡ºå®ç°)
   - [è¯·æ±‚ä¸­æ–­å®ç°](#è¯·æ±‚ä¸­æ–­å®ç°)
   - [æ¶ˆæ¯ç®¡ç†å®ç°](#æ¶ˆæ¯ç®¡ç†å®ç°)
   - [äº¤äº’åŠŸèƒ½å®ç°](#äº¤äº’åŠŸèƒ½å®ç°)
   - [UI ç‰¹æ€§å®ç°](#ui-ç‰¹æ€§å®ç°)
7. [æµ‹è¯•ä¸è°ƒè¯•](#æµ‹è¯•ä¸è°ƒè¯•)
8. [éƒ¨ç½²ä¸ä¼˜åŒ–](#éƒ¨ç½²ä¸ä¼˜åŒ–)

## ç®€ä»‹

æœ¬æŒ‡å—å°†è¯¦ç»†ä»‹ç»å¦‚ä½•ä»é›¶å¼€å§‹æ„å»ºä¸€ä¸ªåŸºäº Vue3 å’Œ TypeScript çš„èŠå¤©åŠŸèƒ½æ¨¡å—ã€‚è¯¥æ¨¡å—å°†é›†æˆé˜¿é‡Œç™¾ç‚¼çš„å¤§è¯­è¨€æ¨¡å‹ï¼Œå®ç°ä¸ AI åŠ©æ‰‹çš„å®æ—¶å¯¹è¯åŠŸèƒ½ï¼Œå…·å¤‡æµå¼è¾“å‡ºã€æ¶ˆæ¯ç®¡ç†ã€å¯¹è¯æ§åˆ¶ç­‰ç‰¹æ€§ã€‚

## ç¯å¢ƒå‡†å¤‡

åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨çš„å¼€å‘ç¯å¢ƒæ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼š

1. Node.js >= 16.x
2. npm æˆ– yarn åŒ…ç®¡ç†å™¨
3. Vue3 é¡¹ç›®ç¯å¢ƒ
4. TypeScript æ”¯æŒ

å®‰è£…å¿…è¦çš„ä¾èµ–åŒ…ï¼š

```bash
npm install ant-design-x-vue ant-design-vue @ant-design/icons-vue @vueuse/core
npm install @langchain/openai @langchain/core
```

## é¡¹ç›®ç»“æ„æ­å»º

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å»ºç«‹é¡¹ç›®çš„ç›®å½•ç»“æ„ï¼š

```
src/
â”œâ”€â”€ views/
â”‚   â””â”€â”€ chat/
â”‚       â”œâ”€â”€ index.vue                 # ä¸»ç»„ä»¶
â”‚       â””â”€â”€ components/
â”‚           â”œâ”€â”€ ChatHeader.vue        # å¤´éƒ¨ç»„ä»¶
â”‚           â”œâ”€â”€ ChatMessages.vue      # æ¶ˆæ¯åˆ—è¡¨ç»„ä»¶
â”‚           â””â”€â”€ ChatInput.vue         # è¾“å…¥ç»„ä»¶
â”œâ”€â”€ ai/
â”‚   â””â”€â”€ aliBaiLian.ts                 # AI æ¥å£å°è£…
â””â”€â”€ utils/
    â””â”€â”€ dialogDrag.ts                 # æ‹–æ‹½åŠŸèƒ½å·¥å…·
```

## æ ¸å¿ƒç»„ä»¶å®ç°

### ä¸»ç»„ä»¶ index.vue

ä¸»ç»„ä»¶æ˜¯èŠå¤©åŠŸèƒ½çš„æ ¸å¿ƒï¼Œè´Ÿè´£åè°ƒå„ä¸ªå­ç»„ä»¶å¹¶ç®¡ç†å…¨å±€çŠ¶æ€ã€‚

#### 1. å¼•å…¥ä¾èµ–å’Œå­ç»„ä»¶

```vue
<script lang="ts" setup>
import { ref, nextTick, h, computed } from 'vue';
import { streamChat } from '@/ai/aliBaiLian'; // å¯¼å…¥æµå¼èŠå¤©å‡½æ•°
import ChatHeader from './components/ChatHeader.vue';
import ChatMessages from './components/ChatMessages.vue';
import ChatInput from './components/ChatInput.vue';
import { useDialogDrag } from '@/utils/dialogDrag'; // å¯¼å…¥æ‹–æ‹½åŠŸèƒ½
```

#### 2. å®šä¹‰ Props å’Œ Emits

```typescript
// ä½¿ç”¨ props å’Œ emit æ§åˆ¶æ˜¾éš
const props = defineProps<{
  open: boolean;
}>();

const emit = defineEmits<{
  (e: 'update:open', value: boolean): void;
  (e: 'update:messages', messages: ChatMessage[]): void;
}>();
```

#### 3. å®šä¹‰æ•°æ®ç»“æ„

```typescript
// å®šä¹‰å¯¹è¯æ¶ˆæ¯ç±»å‹
interface ChatMessage {
  id?: string;
  content: string;
  role: 'user' | 'assistant';
  status?: 'sending' | 'success' | 'error';
}
```

#### 4. å®šä¹‰å“åº”å¼çŠ¶æ€

```typescript
// refs
const chatHeaderRef = ref<InstanceType<typeof ChatHeader> | null>(null);

// ä½¿ç”¨æ‹–æ‹½åŠŸèƒ½
const modalTitleRef = computed(() => chatHeaderRef.value?.modalTitleRef || null);
const { transformStyle } = useDialogDrag(modalTitleRef);

// ==================== State ====================
const inputValue = ref('');
const messages = ref<ChatMessage[]>([
  {
    id: 'welcome',
    content: 'ä½ å¥½ï¼æˆ‘æ˜¯å¤©æœºAIåŠ©ç†ï¼Œæœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®ä½ çš„å—ï¼Ÿ',
    role: 'assistant',
    status: 'success'
  }
]);
const isLoading = ref(false);
const abortController = ref<AbortController | null>(null);
```

#### 5. å®ç°æ ¸å¿ƒæ–¹æ³•

##### handleUserSubmit æ–¹æ³•

è¿™æ˜¯å¤„ç†ç”¨æˆ·æäº¤æ¶ˆæ¯çš„æ ¸å¿ƒæ–¹æ³•ï¼ŒåŒ…å«ä»¥ä¸‹æ­¥éª¤ï¼š

1. éªŒè¯è¾“å…¥å†…å®¹æ˜¯å¦æœ‰æ•ˆ
2. æ·»åŠ ç”¨æˆ·æ¶ˆæ¯åˆ°æ¶ˆæ¯åˆ—è¡¨
3. æ·»åŠ  AI å›å¤å ä½ç¬¦
4. è°ƒç”¨ AI æ¥å£è¿›è¡Œæµå¼å“åº”
5. å®æ—¶æ›´æ–° AI å›å¤å†…å®¹

```typescript
const handleUserSubmit = async (value: string) => {
  // éªŒè¯è¾“å…¥å†…å®¹
  if (!value.trim() || isLoading.value) return;
  
  // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
  const userMessage: ChatMessage = {
    id: Date.now().toString(),
    content: value,
    role: 'user',
    status: 'success'
  };
  
  messages.value.push(userMessage);
  
  // æ·»åŠ  AI å›å¤å ä½ç¬¦
  const aiMessageId = (Date.now() + 1).toString();
  const aiMessage: ChatMessage = {
    id: aiMessageId,
    content: '',
    role: 'assistant',
    status: 'sending'
  };
  
  messages.value.push(aiMessage);
  isLoading.value = true;
  
  try {
    // åˆ›å»ºæ–°çš„ AbortController ç”¨äºå¯èƒ½çš„è¯·æ±‚ä¸­æ–­
    abortController.value = new AbortController();
    
    // è°ƒç”¨æµå¼èŠå¤©å‡½æ•°
    const stream = streamChat(
      messages.value.map(msg => ({
        role: msg.role,
        content: msg.content
      })),
      { signal: abortController.value.signal }
    );
    
    // é€å—å¤„ç†æµå¼å“åº”
    for await (const chunk of stream) {
      // æ£€æŸ¥æ˜¯å¦å·²ä¸­æ–­
      if (abortController.value?.signal.aborted) {
        break;
      }
      
      // æ›´æ–° AI æ¶ˆæ¯å†…å®¹
      const lastMessage = messages.value[messages.value.length - 1];
      if (lastMessage && lastMessage.role === 'assistant') {
        lastMessage.content += chunk.content;
        lastMessage.status = 'success';
      }
      
      // æ»šåŠ¨åˆ°åº•éƒ¨
      nextTick(() => {
        const container = document.querySelector('.ant-x-bubble-list');
        if (container) {
          container.scrollTop = container.scrollHeight;
        }
      });
    }
  } catch (error: unknown) {
    // å¤„ç†é”™è¯¯æˆ–ä¸­æ–­æƒ…å†µ
    const lastMessage = messages.value[messages.value.length - 1];
    if (lastMessage) {
      if ((error as Error).name === 'AbortError' || (error as Error).message === 'Request aborted') {
        // è¯·æ±‚è¢«ä¸­æ–­æ—¶ï¼Œä¿ç•™å·²ç”Ÿæˆçš„å†…å®¹ï¼Œä»…æ›´æ–°çŠ¶æ€
        if (lastMessage.role === 'assistant') {
          // åªæœ‰å½“æ¶ˆæ¯å†…å®¹ä¸ºç©ºæ—¶æ‰æ˜¾ç¤º"è¯·æ±‚å·²è¢«å–æ¶ˆ"
          if (!lastMessage.content) {
            lastMessage.content = 'è¯·æ±‚å·²è¢«å–æ¶ˆ';
          }
          lastMessage.status = 'error';
        }
      } else {
        if (lastMessage.role === 'assistant') {
          lastMessage.content = 'è¯·æ±‚å¤±è´¥ï¼Œè¯·é‡è¯•ï¼';
          lastMessage.status = 'error';
        }
      }
    }
  } finally {
    isLoading.value = false;
  }
};
```

##### handleClose æ–¹æ³•

å¤„ç†å…³é—­èŠå¤©çª—å£çš„æ“ä½œï¼š

```typescript
const handleClose = () => {
  // å¦‚æœæ­£åœ¨åŠ è½½ï¼Œåªä¸­æ–­è¯·æ±‚ä½†ä¸æ”¹å˜æ¶ˆæ¯çŠ¶æ€
  if (isLoading.value && abortController.value) {
    abortController.value.abort();
    // ä¸å†æ¸…é™¤æ¶ˆæ¯ï¼Œä¿æŒç°æœ‰å¯¹è¯å†…å®¹
  }
  emit('update:open', false);
};
```

##### handleStopGenerate æ–¹æ³•

åœæ­¢ç”Ÿæˆå›å¤ï¼š

```typescript
// æ–°å¢å‡½æ•°ï¼šåœæ­¢ç”Ÿæˆ
const handleStopGenerate = () => {
  if (isLoading.value && abortController.value) {
    // è®°å½•ä¸­æ–­æ“ä½œ
    console.log('Stopping generation...');
    abortController.value.abort();
    // ç«‹å³è®¾ç½®åŠ è½½çŠ¶æ€ä¸º false
    isLoading.value = false;
    // å¼ºåˆ¶åˆ·æ–°UI
    nextTick(() => {});
  }
};
```

##### å…¶ä»–è¾…åŠ©æ–¹æ³•

```typescript
const handleClearMessages = () => {
  messages.value = [{
    id: 'welcome',
    content: 'ä½ å¥½ï¼æˆ‘æ˜¯å¤©æœºAIåŠ©ç†ï¼Œæœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®ä½ çš„å—ï¼Ÿ',
    role: 'assistant',
    status: 'success'
  }];
};

const handleRetry = (messageId: string) => {
  // TODO: å®ç°é‡è¯•åŠŸèƒ½
  console.log('Retry message:', messageId);
};

const handleCopy = (content: string) => {
  // TODO: å®ç°å¤åˆ¶åŠŸèƒ½
  console.log('Copy content:', content);
};

const handleLike = (messageId: string) => {
  // TODO: å®ç°ç‚¹èµåŠŸèƒ½
  console.log('Like message:', messageId);
};

const handleDislike = (messageId: string) => {
  // TODO: å®ç°ç‚¹è¸©åŠŸèƒ½
  console.log('Dislike message:', messageId);
};

const handleQuestionClick = (question: string) => {
  handleUserSubmit(question);
};

const handleQuickQuestion = (question: string) => {
  handleUserSubmit(question);
};
```

#### 6. æ¨¡æ¿éƒ¨åˆ†

```vue
<template>
  <!-- ä½¿ç”¨ ant-design-x-vue çš„ XProvider åŒ…è£¹æ•´ä¸ªå¯¹è¯ç•Œé¢ -->
  <a-modal
    :open="props.open"
    @update:open="(val: boolean) => emit('update:open', val)"
    :wrap-style="{ overflow: 'hidden' }"
    :mask="false"
    :closable="false"
    :keyboard="false"
    :maskClosable="false"
    :footer="null"
    width="520px"
    class="ai-assistant-modal"
    :style="transformStyle"
  >
    <div class="chat-wrapper">
      <!-- å¯¹è¯åŒº - header -->
      <ChatHeader
        ref="chatHeaderRef"
        :messages="messages"
        @close="handleClose"
        @clear-messages="handleClearMessages"
      />
      
      <!-- å¯¹è¯åŒº - æ¶ˆæ¯åˆ—è¡¨ -->
      <ChatMessages
        :messages="messages"
        :is-loading="isLoading"
        @retry="handleRetry"
        @copy="handleCopy"
        @like="handleLike"
        @dislike="handleDislike"
        @question-click="handleQuestionClick"
      />

      <!-- å¯¹è¯åŒº - è¾“å…¥æ¡† -->
      <ChatInput
        :input-value="inputValue"
        :is-loading="isLoading"
        @update:inputValue="(val) => inputValue = val"
        @submit="() => {
          handleUserSubmit(inputValue);
          inputValue = '';
        }"
        @stop-generate="handleStopGenerate"
        @quick-question="handleQuickQuestion"
      />
    </div>
  </a-modal>
</template>
```

#### 7. æ ·å¼éƒ¨åˆ†

```vue
<style scoped lang="scss">
.chat-wrapper {
  display: flex;
  flex-direction: column;
  height: 100%;
}
</style>
```

### å¤´éƒ¨ç»„ä»¶ ChatHeader.vue

è´Ÿè´£èŠå¤©çª—å£å¤´éƒ¨ UI å’ŒåŠŸèƒ½ã€‚

#### 1. å¼•å…¥ä¾èµ–

```vue
<script lang="ts" setup>
import { ref, h } from 'vue';
import { Button, Space } from 'ant-design-vue';
import { PlusOutlined, CloseOutlined } from '@ant-design/icons-vue';
import { useDialogDrag } from '@/utils/dialogDrag';
```

#### 2. å®šä¹‰ Props å’Œ Emits

```typescript
const props = defineProps<{
  messages: {
    id?: string;
    content: string;
    role: 'user' | 'assistant';
    status?: 'sending' | 'success' | 'error';
  }[];
  onClose: () => void;
  onClearMessages: () => void;
}>();

const emit = defineEmits<{
  (e: 'clear-messages'): void;
}>();
```

#### 3. å®ç°æ‹–æ‹½åŠŸèƒ½

```typescript
// ä½¿ç”¨æ‹–æ‹½åŠŸèƒ½
const modalTitleRef = ref<HTMLDivElement | null>(null);
const { transformStyle } = useDialogDrag(modalTitleRef);

defineExpose({
  modalTitleRef
});
```

#### 4. æ¨¡æ¿éƒ¨åˆ†

```vue
<template>
  <div 
    ref="modalTitleRef"
    class="chat-header"
  >
    <div class="header-title">
      âœ¨ å¤©æœºAIåŠ©ç†
    </div>
    <Space :size="0">
      <Button
        type="text"
        :icon="h(PlusOutlined)"
        class="header-button"
        @click="$emit('clear-messages')"
      />
      <Button
        type="text"
        :icon="h(CloseOutlined)"
        class="header-button"
        @click="onClose"
      />
    </Space>
  </div>
</template>
```

#### 5. æ ·å¼éƒ¨åˆ†

```vue
<style scoped lang="scss">
.chat-header {
  height: 52px;
  box-sizing: border-box;
  border-bottom: 1px solid #f0f0f0;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 10px 0 16px;
  cursor: move; // æ˜¾ç¤ºå¯ä»¥æ‹–æ‹½
}

.header-title {
  font-weight: 600;
  font-size: 15px;
}

.header-button {
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
}
</style>
```

### æ¶ˆæ¯åˆ—è¡¨ç»„ä»¶ ChatMessages.vue

è´Ÿè´£å±•ç¤ºå¯¹è¯æ¶ˆæ¯å’Œæ¬¢è¿ä¿¡æ¯ã€‚

#### 1. å¼•å…¥ä¾èµ–

```vue
<script lang="ts" setup>
import { h } from 'vue';
import { Bubble, Welcome, Prompts } from 'ant-design-x-vue';
import { Button, Space, Spin } from 'ant-design-vue';
import { 
  ReloadOutlined, 
  CopyOutlined, 
  LikeOutlined, 
  DislikeOutlined
} from '@ant-design/icons-vue';
```

#### 2. å®šä¹‰ Props å’Œ Emits

```typescript
const props = defineProps<{
  messages: {
    id?: string;
    content: string;
    role: 'user' | 'assistant';
    status?: 'sending' | 'success' | 'error';
  }[];
  isLoading: boolean;
}>();

const emit = defineEmits<{
  (e: 'retry', messageId: string): void;
  (e: 'copy', content: string): void;
  (e: 'like', messageId: string): void;
  (e: 'dislike', messageId: string): void;
  (e: 'question-click', question: string): void;
}>();
```

#### 3. å®šä¹‰å¸¸é‡å’Œè§’è‰²é…ç½®

```typescript
const MOCK_QUESTIONS = [
  'ä½ å¥½ï¼Œä½ èƒ½å¸®æˆ‘åšä»€ä¹ˆï¼Ÿ',
  'è¯·ä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±',
  'å¦‚ä½•ä½¿ç”¨è¿™ä¸ªç³»ç»Ÿï¼Ÿ'
];

const AGENT_PLACEHOLDER = 'AIåŠ©æ‰‹æ­£åœ¨æ€è€ƒä¸­...';

// å®šä¹‰å¤´åƒURL
const USER_AVATAR = 'https://avatars.githubusercontent.com/u/12345678'; // ç”¨æˆ·å¤´åƒå ä½ç¬¦
const AI_AVATAR = 'https://avatars.githubusercontent.com/u/98765432'; // AIåŠ©æ‰‹å¤´åƒå ä½ç¬¦

const roles: typeof Bubble.List['roles'] = {
  assistant: {
    placement: 'start',
    avatar: AI_AVATAR,
    footer: (message: any) => h('div', { style: { display: 'flex' } }, [
      h(Button, { 
        type: 'text', 
        size: 'small', 
        icon: h(ReloadOutlined), 
        onClick: () => emit('retry', message.id) 
      }),
      h(Button, { 
        type: 'text', 
        size: 'small', 
        icon: h(CopyOutlined), 
        onClick: () => emit('copy', message.content) 
      }),
      h(Button, { 
        type: 'text', 
        size: 'small', 
        icon: h(LikeOutlined), 
        onClick: () => emit('like', message.id) 
      }),
      h(Button, { 
        type: 'text', 
        size: 'small', 
        icon: h(DislikeOutlined), 
        onClick: () => emit('dislike', message.id) 
      }),
    ]),
    loadingRender: () => h(
      Space,
      {},
      [
        h(Spin, { size: 'small' }, []),
        AGENT_PLACEHOLDER,
      ]
    )
  },
  user: { 
    placement: 'end',
    avatar: USER_AVATAR
  },
};
```

#### 4. æ¨¡æ¿éƒ¨åˆ†

```vue
<template>
  <div class="chat-list">
    <Bubble.List
      v-if="messages && messages.length > 0 && !(messages.length === 1 && messages[0]?.id === 'welcome')"
      class="chat-bubble-list"
      :items="messages.map((msg) => ({
        id: msg.id,
        content: msg.content,
        role: msg.role,
        classes: {
          content: msg.status === 'sending' ? 'loading-message' : '',
        },
        loading: msg.status === 'sending',
        typing: msg.status === 'sending' ? { step: 5, interval: 20 } : false,
      }))" 
      :roles="roles"
    />
    <template v-else>
      <Welcome
        variant="borderless"
        title="ğŸ‘‹ ä½ å¥½ï¼Œæˆ‘æ˜¯å¤©æœºAIåŠ©ç†"
        description="åŸºäºå…ˆè¿›çš„äººå·¥æ™ºèƒ½æŠ€æœ¯ï¼Œæˆ‘å¯ä»¥å›ç­”é—®é¢˜ã€åˆ›ä½œæ–‡å­—ï¼Œå¦‚å†™æ•…äº‹ã€å†™å…¬æ–‡ã€å†™é‚®ä»¶ã€å†™å‰§æœ¬ã€é€»è¾‘æ¨ç†ã€ç¼–ç¨‹ç­‰ï¼Œè¿˜èƒ½è¡¨è¾¾è§‚ç‚¹ï¼Œç©æ¸¸æˆç­‰ã€‚"
        class="chat-welcome"
      />
      <Prompts
        vertical
        title="æˆ‘å¯ä»¥å¸®åŠ©æ‚¨ï¼š"
        :items="MOCK_QUESTIONS.map((i) => ({ key: i, description: i }))"
        class="chat-prompts"
        :styles="{
          title: { fontSize: 14 },
        }"
        @item-click="(info: any) => $emit('question-click', info?.data?.description as string)"
      />
    </template>
  </div>
</template>
```

#### 5. æ ·å¼éƒ¨åˆ†

```vue
<style scoped lang="scss">
.chat-list {
  overflow: auto;
  padding-block: 16px;
  flex: 1;
  
  // æ·»åŠ è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼ç¡®ä¿åœ¨å„æµè§ˆå™¨ä¸­éƒ½èƒ½æ­£å¸¸æ˜¾ç¤º
  scrollbar-width: thin;
  scrollbar-color: #c1c1c1 #f5f5f5;
  
  // ç¡®ä¿å®¹å™¨æœ‰è¶³å¤Ÿé«˜åº¦ä»¥æ˜¾ç¤ºæ»šåŠ¨æ¡
  min-height: 200px;
  
  // è®¾ç½®æœ€å¤§é«˜åº¦ä»¥é˜²æ­¢å¯¹è¯æ¡†è¢«æ’‘å¤§
  max-height: calc(100vh - 400px);
}

.chat-welcome {
  margin-inline: 16px;
  padding: 12px 16px;
  border-radius: 2px 12px 12px 12px;
  background: #f5f5f5;
  margin-bottom: 16px;
}

.loading-message {
  background-image: linear-gradient(90deg, #1890ff 0%, #0050b3 100%);
  background-size: 100% 2px;
  background-repeat: no-repeat;
  background-position: bottom;
}

.chat-bubble-list {
  height: 50%;
  padding-inline: 12px;
}

.chat-prompts {
  margin-inline: 16px;
}
</style>
```

### è¾“å…¥ç»„ä»¶ ChatInput.vue

æä¾›æ¶ˆæ¯è¾“å…¥å’Œå¿«é€Ÿæé—®åŠŸèƒ½ã€‚

#### 1. å¼•å…¥ä¾èµ–

```vue
<script lang="ts" setup>
import { ref, h } from 'vue';
import { Sender, XProvider, } from 'ant-design-x-vue';
import { Button } from 'ant-design-vue';
```

#### 2. å®šä¹‰ Props å’Œ Emits

```typescript
const props = defineProps<{
  inputValue: string;
  isLoading: boolean;
  onStopGenerate: () => void;
}>();

const emit = defineEmits<{
  (e: 'update:inputValue', value: string): void;
  (e: 'submit'): void;
  (e: 'quick-question', question: string): void;
}>();

const senderRef = ref<InstanceType<typeof Sender> | null>(null);
```

#### 3. æ¨¡æ¿éƒ¨åˆ†

```vue
<template>
  <div class="chat-send">
    <div class="send-action">
      <Button @click="$emit('quick-question', 'ä½ å¥½ï¼Œä½ èƒ½å¸®æˆ‘åšä»€ä¹ˆï¼Ÿ')">
        åŠŸèƒ½ä»‹ç»
      </Button>
      <Button @click="$emit('quick-question', 'è¯·ä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±')">
        è‡ªæˆ‘ä»‹ç»
      </Button>
    </div>
    
    <!-- ä½¿ç”¨ XProvider åŒ…è£¹ Conversations å’Œ Sender -->
    <XProvider>
      <!-- ä½¿ç”¨ Sender ç»„ä»¶å‘é€æ¶ˆæ¯ -->
      <Sender 
        ref="senderRef"
        :loading="isLoading"
        :value="inputValue"
        placeholder="è¯·è¾“å…¥æ‚¨çš„é—®é¢˜..."
        @change="(v: string) => $emit('update:inputValue', v)"
        @submit="() => $emit('submit')"
        @cancel="onStopGenerate"
      >
      </Sender>
    </XProvider>
  </div>
</template>
```

#### 4. æ ·å¼éƒ¨åˆ†

```vue
<style scoped lang="scss">
.chat-send {
  padding: 12px;
}

.send-action {
  display: flex;
  align-items: center;
  margin-bottom: 12px;
  gap: 8px;
}
</style>
```

## AI é›†æˆå®ç°

AI åŠŸèƒ½é€šè¿‡ [aliBaiLian.ts](file:///e:/Users/Shiping/%E8%AF%BE%E5%A0%82%E5%89%8D%E7%AB%AF/cdp_front/src/ai/aliBaiLian.ts) æ–‡ä»¶å°è£…ï¼Œä½¿ç”¨ [langchain.js](file:///e:/Users/Shiping/%E8%AF%BE%E5%A0%82%E5%89%8D%E7%AB%AF/cdp_front/node_modules/langchain/dist/lcel/index.js#L4-L4) æ¡†æ¶ä¸é˜¿é‡Œç™¾ç‚¼æœåŠ¡é€šä¿¡ã€‚

### 1. å¼•å…¥ä¾èµ–

```typescript
import { ChatOpenAI } from "@langchain/openai";
import { HumanMessage, SystemMessage } from "@langchain/core/messages";
```

### 2. åˆå§‹åŒ– ChatOpenAI å®¢æˆ·ç«¯

```typescript
// åˆå§‹åŒ– ChatOpenAI å®¢æˆ·ç«¯ï¼Œé…ç½®ä¸ºé˜¿é‡Œç™¾ç‚¼æœåŠ¡
const chatModel = new ChatOpenAI({
  configuration: {
    apiKey: import.meta.env.VITE_DASHSCOPE_API_KEY || "sk----", // æ›¿æ¢ä¸ºå®é™… API Key
    baseURL: "https://dashscope.aliyuncs.com/compatible-mode/v1",
  },
  model: "qwen3-max", // æŒ‡å®šä½¿ç”¨çš„æ¨¡å‹
});
```

### 3. å°è£…æµå¼è°ƒç”¨æ–¹æ³•

```typescript
/**
 * å°è£…æµå¼è°ƒç”¨æ–¹æ³•
 * @param messages å¯¹è¯æ¶ˆæ¯æ•°ç»„
 * @param options é…ç½®é€‰é¡¹ï¼Œæ”¯æŒ signal ç”¨äºä¸­æ–­è¯·æ±‚
 * @returns æµå¼å“åº”
 */
export async function* streamChat(
  messages: { role: string; content: string }[],
  options?: { signal?: AbortSignal }
) {
  // è½¬æ¢æ¶ˆæ¯æ ¼å¼
  const formattedMessages = messages.map(msg => {
    if (msg.role === "system") {
      return new SystemMessage(msg.content);
    } else {
      return new HumanMessage(msg.content);
    }
  });

  // è°ƒç”¨æ¨¡å‹å¹¶è·å–æµå¼å“åº”ï¼Œä¼ é€’ signal ç”¨äºä¸­æ–­è¯·æ±‚
  const stream = await chatModel.stream(formattedMessages, {
    signal: options?.signal
  });

  // é€ä¸ªè¿”å›æµå¼æ•°æ®å—
  for await (const chunk of stream) {
    // æ£€æŸ¥æ˜¯å¦å·²ä¸­æ–­
    if (options?.signal?.aborted) {
      // ç«‹å³ä¸­æ–­å¹¶è¿”å›
      return;
    }
    yield chunk;
  }
}
```

## åŠŸèƒ½ç‰¹æ€§è¯¦è§£

### æµå¼è¾“å‡ºå®ç°

æµå¼è¾“å‡ºæ˜¯æœ¬èŠå¤©åŠŸèƒ½çš„æ ¸å¿ƒç‰¹æ€§ä¹‹ä¸€ï¼Œå®ƒèƒ½è®©ç”¨æˆ·çœ‹åˆ° AI å›å¤é€æ­¥ç”Ÿæˆçš„è¿‡ç¨‹ï¼Œæä¾›ç±»ä¼¼æ‰“å­—æœºçš„æ•ˆæœã€‚

#### å®ç°åŸç†

1. ä½¿ç”¨ `async function*` å®šä¹‰ç”Ÿæˆå™¨å‡½æ•°ï¼Œæ”¯æŒå¼‚æ­¥è¿­ä»£
2. é€šè¿‡ `for await...of` å¾ªç¯é€å—å¤„ç†å“åº”æ•°æ®
3. æ¯æ¥æ”¶åˆ°ä¸€å—æ•°æ®å°±ç«‹å³æ›´æ–° UIï¼Œè€Œä¸æ˜¯ç­‰å¾…å…¨éƒ¨æ•°æ®æ¥æ”¶å®Œæ¯•

#### æ ¸å¿ƒä»£ç è§£æ

```typescript
// é€å—å¤„ç†æµå¼å“åº”
for await (const chunk of stream) {
  // æ£€æŸ¥æ˜¯å¦å·²ä¸­æ–­
  if (abortController.value?.signal.aborted) {
    break;
  }
  
  // æ›´æ–° AI æ¶ˆæ¯å†…å®¹
  const lastMessage = messages.value[messages.value.length - 1];
  if (lastMessage && lastMessage.role === 'assistant') {
    lastMessage.content += chunk.content;
    lastMessage.status = 'success';
  }
  
  // æ»šåŠ¨åˆ°åº•éƒ¨
  nextTick(() => {
    const container = document.querySelector('.ant-x-bubble-list');
    if (container) {
      container.scrollTop = container.scrollHeight;
    }
  });
}
```

#### å…³é”®æŠ€æœ¯ç‚¹

1. **å¼‚æ­¥è¿­ä»£å™¨**: ä½¿ç”¨ `for await...of` è¯­æ³•å¤„ç†å¼‚æ­¥æ•°æ®æµ
2. **å®æ—¶æ›´æ–°**: æ¯æ¥æ”¶åˆ°ä¸€å—æ•°æ®å°±ç«‹å³æ›´æ–°æ¶ˆæ¯å†…å®¹
3. **DOM æ“ä½œä¼˜åŒ–**: ä½¿ç”¨ `nextTick` ç¡®ä¿ DOM æ›´æ–°åå†æ‰§è¡Œæ»šåŠ¨æ“ä½œ
4. **ä¸­æ–­å¤„ç†**: åœ¨æ¯æ¬¡å¾ªç¯ä¸­æ£€æŸ¥è¯·æ±‚æ˜¯å¦å·²è¢«ä¸­æ–­

### è¯·æ±‚ä¸­æ–­å®ç°

è¯·æ±‚ä¸­æ–­åŠŸèƒ½å…è®¸ç”¨æˆ·åœ¨ AI å›å¤ç”Ÿæˆè¿‡ç¨‹ä¸­éšæ—¶åœæ­¢è¯·æ±‚ï¼Œæé«˜ç³»ç»Ÿçš„å¯æ§æ€§ã€‚

#### å®ç°åŸç†

1. ä½¿ç”¨ [AbortController](file:///e:/Users/Shiping/%E8%AF%BE%E5%A0%82%E5%89%8D%E7%AB%AF/cdp_front/node_modules/typescript/lib/lib.dom.d.ts#L1943-L1952) åˆ›å»ºå¯ä¸­æ–­çš„ä¿¡å·
2. å°†ä¿¡å·ä¼ é€’ç»™ç½‘ç»œè¯·æ±‚
3. åœ¨éœ€è¦ä¸­æ–­æ—¶è°ƒç”¨ `abort()` æ–¹æ³•

#### æ ¸å¿ƒä»£ç è§£æ

```typescript
// åˆ›å»ºæ–°çš„ AbortController ç”¨äºå¯èƒ½çš„è¯·æ±‚ä¸­æ–­
abortController.value = new AbortController();

// è°ƒç”¨æµå¼èŠå¤©å‡½æ•°æ—¶ä¼ é€’ signal
const stream = streamChat(messages, { signal: abortController.value.signal });

// åœ¨éœ€è¦ä¸­æ–­æ—¶è°ƒç”¨ abort() æ–¹æ³•
const handleStopGenerate = () => {
  if (isLoading.value && abortController.value) {
    abortController.value.abort();
    isLoading.value = false;
  }
};
```

#### é”™è¯¯å¤„ç†

```typescript
catch (error: unknown) {
  // å¤„ç†é”™è¯¯æˆ–ä¸­æ–­æƒ…å†µ
  const lastMessage = messages.value[messages.value.length - 1];
  if (lastMessage) {
    if ((error as Error).name === 'AbortError' || (error as Error).message === 'Request aborted') {
      // è¯·æ±‚è¢«ä¸­æ–­æ—¶çš„å¤„ç†é€»è¾‘
    } else {
      // å…¶ä»–é”™è¯¯çš„å¤„ç†é€»è¾‘
    }
  }
}
```

#### å…³é”®æŠ€æœ¯ç‚¹

1. **AbortController**: ç°ä»£æµè§ˆå™¨æä¾›çš„æ ‡å‡† APIï¼Œç”¨äºä¸­æ–­å¼‚æ­¥æ“ä½œ
2. **ä¿¡å·ä¼ é€’**: å°† abort signal ä¼ é€’ç»™åº•å±‚ç½‘ç»œè¯·æ±‚
3. **é”™è¯¯åŒºåˆ†**: åŒºåˆ†ä¸­æ–­é”™è¯¯å’Œå…¶ä»–ç±»å‹é”™è¯¯
4. **çŠ¶æ€ç®¡ç†**: æ­£ç¡®æ›´æ–°åŠ è½½çŠ¶æ€å’Œæ¶ˆæ¯çŠ¶æ€

### æ¶ˆæ¯ç®¡ç†å®ç°

æ¶ˆæ¯ç®¡ç†åŠŸèƒ½è´Ÿè´£ç»´æŠ¤å¯¹è¯å†å²ã€è·Ÿè¸ªæ¶ˆæ¯çŠ¶æ€ä»¥åŠæä¾›æ¸…ç©ºå¯¹è¯ç­‰åŠŸèƒ½ã€‚

#### æ•°æ®ç»“æ„è®¾è®¡

```typescript
interface ChatMessage {
  id?: string;
  content: string;
  role: 'user' | 'assistant';
  status?: 'sending' | 'success' | 'error';
}
```

#### æ¶ˆæ¯çŠ¶æ€è·Ÿè¸ª

æ¯æ¡æ¶ˆæ¯éƒ½æœ‰ä¸€ä¸ª `status` å­—æ®µæ¥æ ‡è¯†å…¶çŠ¶æ€ï¼š

- `sending`: æ¶ˆæ¯æ­£åœ¨å‘é€æˆ–ç”Ÿæˆä¸­
- `success`: æ¶ˆæ¯å‘é€æˆ–ç”ŸæˆæˆåŠŸ
- `error`: æ¶ˆæ¯å‘é€æˆ–ç”Ÿæˆå‡ºé”™

#### æ¸…ç©ºå¯¹è¯å†å²

```typescript
const handleClearMessages = () => {
  messages.value = [{
    id: 'welcome',
    content: 'ä½ å¥½ï¼æˆ‘æ˜¯å¤©æœºAIåŠ©ç†ï¼Œæœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®ä½ çš„å—ï¼Ÿ',
    role: 'assistant',
    status: 'success'
  }];
};
```

#### å…³é”®æŠ€æœ¯ç‚¹

1. **å“åº”å¼æ•°æ®**: ä½¿ç”¨ Vue çš„ `ref` æ¥ç®¡ç†å“åº”å¼æ¶ˆæ¯åˆ—è¡¨
2. **çŠ¶æ€ä¸€è‡´æ€§**: ç¡®ä¿æ¶ˆæ¯çŠ¶æ€åœ¨å„ä¸ªæ“ä½œä¸­ä¿æŒä¸€è‡´
3. **åˆå§‹çŠ¶æ€**: æä¾›å‹å¥½çš„åˆå§‹æ¬¢è¿æ¶ˆæ¯
4. **å†…å­˜ç®¡ç†**: åˆç†ç®¡ç†æ¶ˆæ¯åˆ—è¡¨ï¼Œé¿å…æ— é™å¢é•¿

### äº¤äº’åŠŸèƒ½å®ç°

äº¤äº’åŠŸèƒ½åŒ…æ‹¬å¤åˆ¶æ¶ˆæ¯ã€ç‚¹èµ/ç‚¹è¸©åé¦ˆã€é‡è¯•åŠŸèƒ½å’Œå¿«æ·æé—®ç­‰ã€‚

#### äº‹ä»¶ä¼ é€’æœºåˆ¶

é€šè¿‡ Vue çš„äº‹ä»¶ç³»ç»Ÿå®ç°çˆ¶å­ç»„ä»¶é—´é€šä¿¡ï¼š

```typescript
// å­ç»„ä»¶è§¦å‘äº‹ä»¶
emit('retry', message.id);

// çˆ¶ç»„ä»¶ç›‘å¬äº‹ä»¶
@retry="handleRetry"
```

#### å¤åˆ¶åŠŸèƒ½å®ç°æ€è·¯

```typescript
const handleCopy = (content: string) => {
  // å¯ä»¥ä½¿ç”¨ Clipboard API å®ç°å¤åˆ¶åŠŸèƒ½
  navigator.clipboard.writeText(content)
    .then(() => {
      // å¤åˆ¶æˆåŠŸçš„æç¤º
    })
    .catch(err => {
      // å¤åˆ¶å¤±è´¥çš„å¤„ç†
    });
};
```

#### ç‚¹èµ/ç‚¹è¸©åŠŸèƒ½å®ç°æ€è·¯

```typescript
const handleLike = (messageId: string) => {
  // å¯ä»¥å°†åé¦ˆå­˜å‚¨åˆ°æœ¬åœ°æˆ–å‘é€åˆ°æœåŠ¡å™¨
  // æ›´æ–° UI çŠ¶æ€ä»¥åæ˜ ç”¨æˆ·çš„åé¦ˆ
};

const handleDislike = (messageId: string) => {
  // ç±»ä¼¼ç‚¹èµåŠŸèƒ½çš„å®ç°
};
```

#### é‡è¯•åŠŸèƒ½å®ç°æ€è·¯

```typescript
const handleRetry = (messageId: string) => {
  // æ‰¾åˆ°éœ€è¦é‡è¯•çš„æ¶ˆæ¯
  // é‡æ–°å‘é€è¯·æ±‚
  // æ›´æ–°ç›¸å…³çŠ¶æ€
};
```

#### å¿«æ·æé—®åŠŸèƒ½

```typescript
const handleQuickQuestion = (question: string) => {
  handleUserSubmit(question);
};
```

#### å…³é”®æŠ€æœ¯ç‚¹

1. **äº‹ä»¶é©±åŠ¨**: ä½¿ç”¨ Vue çš„äº‹ä»¶ç³»ç»Ÿå®ç°ç»„ä»¶é—´é€šä¿¡
2. **ç”¨æˆ·ä½“éªŒ**: æä¾›å³æ—¶åé¦ˆå’ŒçŠ¶æ€æ›´æ–°
3. **åŠŸèƒ½æ‰©å±•**: ä¸ºæœªæ¥å¢åŠ æ›´å¤šäº¤äº’åŠŸèƒ½é¢„ç•™æ¥å£
4. **é”™è¯¯å¤„ç†**: å¦¥å–„å¤„ç†å„ç§å¼‚å¸¸æƒ…å†µ

### UI ç‰¹æ€§å®ç°

UI ç‰¹æ€§åŒ…æ‹¬æ‹–æ‹½ç§»åŠ¨çª—å£ã€å“åº”å¼è®¾è®¡å’Œç¾è§‚çš„æ°”æ³¡æ ·å¼ç­‰ã€‚

#### æ‹–æ‹½åŠŸèƒ½å®ç°

æ‹–æ‹½åŠŸèƒ½é€šè¿‡ [useDialogDrag](file:///e:/Users/Shiping/%E8%AF%BE%E5%A0%82%E5%89%8D%E7%AB%AF/cdp_front/src/utils/dialogDrag.ts#L10-L57) ç»„åˆå‡½æ•°å®ç°ï¼š

```typescript
// åœ¨ ChatHeader.vue ä¸­
const modalTitleRef = ref<HTMLDivElement | null>(null);
const { transformStyle } = useDialogDrag(modalTitleRef);

// åº”ç”¨æ ·å¼
<div 
  ref="modalTitleRef"
  class="chat-header"
  :style="transformStyle"
>
```

#### useDialogDrag å·¥å…·å‡½æ•°

```typescript
import { ref, computed, watch, watchEffect } from 'vue';
import type { Ref } from 'vue';
import { useDraggable } from '@vueuse/core';

export function useDialogDrag(modalTitleRef: Ref<HTMLElement | null>) {
  // ä½¿ç”¨ useDraggable åˆ›å»ºæ‹–æ‹½ç›¸å…³å“åº”å¼æ•°æ®
  const { x, y, isDragging } = useDraggable(modalTitleRef);

  // å®šä¹‰æ‹–æ‹½ç›¸å…³çš„å“åº”å¼å˜é‡
  const startX = ref(0);
  const startY = ref(0);
  const startedDrag = ref(false);
  const preTransformX = ref(0);
  const preTransformY = ref(0);
  const dragRect = ref({ left: 0, right: 0, top: 0, bottom: 0 });
  const transformX = ref(0);
  const transformY = ref(0);

  // ç›‘å¬åæ ‡å˜åŒ–ï¼Œåˆå§‹åŒ–æ‹–æ‹½å‚æ•°
  watch([x, y], () => {
    if (!startedDrag.value) {
      startX.value = x.value;
      startY.value = y.value;
      const bodyRect = document.body.getBoundingClientRect();
      const titleRect = modalTitleRef.value?.getBoundingClientRect();
      if (titleRect) {
        dragRect.value.right = bodyRect.width - titleRect.width;
        dragRect.value.bottom = bodyRect.height - titleRect.height;
      }
      preTransformX.value = transformX.value;
      preTransformY.value = transformY.value;
    }
    startedDrag.value = true;
  });

  // ç›‘å¬æ‹–æ‹½çŠ¶æ€å˜åŒ–
  watch(isDragging, (dragging) => {
    if (!dragging) startedDrag.value = false;
  });

  // è®¡ç®—å˜æ¢ä½ç½®
  watchEffect(() => {
    if (startedDrag.value) {
      transformX.value =
        preTransformX.value +
        Math.min(Math.max(dragRect.value.left, x.value), dragRect.value.right) -
        startX.value;
      transformY.value =
        preTransformY.value +
        Math.min(Math.max(dragRect.value.top, y.value), dragRect.value.bottom) -
        startY.value;
    }
  });

  // è¿”å›å˜æ¢æ ·å¼
  const transformStyle = computed(() => ({
    transform: `translate(${transformX.value}px, ${transformY.value}px)`,
  }));

  return {
    transformStyle
  };
}
```

#### å“åº”å¼è®¾è®¡

ä½¿ç”¨ Flexbox å¸ƒå±€å®ç°å“åº”å¼è®¾è®¡ï¼š

```scss
.chat-wrapper {
  display: flex;
  flex-direction: column;
  height: 100%;
}

.chat-list {
  overflow: auto;
  padding-block: 16px;
  flex: 1;
}
```

#### æ°”æ³¡æ ·å¼ç¾åŒ–

```scss
.loading-message {
  background-image: linear-gradient(90deg, #1890ff 0%, #0050b3 100%);
  background-size: 100% 2px;
  background-repeat: no-repeat;
  background-position: bottom;
}
```

#### å…³é”®æŠ€æœ¯ç‚¹

1. **æ‹–æ‹½å®ç°**: ä½¿ç”¨ [@vueuse/core](file:///e:/Users/Shiping/%E8%AF%BE%E5%A0%82%E5%89%8D%E7%AB%AF/cdp_front/node_modules/@vueuse/core/index.d.cts#L71-L71) çš„ [useDraggable](file:///e:/Users/Shiping/%E8%AF%BE%E5%A0%82%E5%89%8D%E7%AB%AF/cdp_front/node_modules/@vueuse/core/index.d.cts#L3785-L3785) å®ç°æ‹–æ‹½åŠŸèƒ½
2. **æ ·å¼éš”ç¦»**: ä½¿ç”¨ scoped CSS ç¡®ä¿æ ·å¼ä¸å½±å“å…¶ä»–ç»„ä»¶
3. **ç”¨æˆ·ä½“éªŒ**: æä¾›ç›´è§‚çš„è§†è§‰åé¦ˆå’Œäº¤äº’æç¤º
4. **å…¼å®¹æ€§**: è€ƒè™‘ä¸åŒæµè§ˆå™¨çš„å…¼å®¹æ€§é—®é¢˜

## æµ‹è¯•ä¸è°ƒè¯•

### å•å…ƒæµ‹è¯•

ä¸ºå…³é”®åŠŸèƒ½ç¼–å†™å•å…ƒæµ‹è¯•ï¼š

```typescript
// ç¤ºä¾‹ï¼šæµ‹è¯• handleUserSubmit æ–¹æ³•
describe('handleUserSubmit', () => {
  it('should add user message and AI placeholder', async () => {
    // å‡†å¤‡æµ‹è¯•æ•°æ®
    const wrapper = mount(ChatComponent);
    const inputValue = 'Hello AI';
    
    // æ‰§è¡Œæµ‹è¯•
    await wrapper.vm.handleUserSubmit(inputValue);
    
    // éªŒè¯ç»“æœ
    expect(wrapper.vm.messages).toHaveLength(3); // welcome + user + AI
    expect(wrapper.vm.messages[1].content).toBe(inputValue);
    expect(wrapper.vm.messages[2].content).toBe('');
  });
});
```

### è°ƒè¯•æŠ€å·§

1. ä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·æ£€æŸ¥ç½‘ç»œè¯·æ±‚
2. æ·»åŠ é€‚å½“çš„æ—¥å¿—è¾“å‡ºä»¥ä¾¿è¿½è¸ªæ‰§è¡Œæµç¨‹
3. ä½¿ç”¨ Vue DevTools æ£€æŸ¥ç»„ä»¶çŠ¶æ€å˜åŒ–
4. æ¨¡æ‹Ÿä¸åŒçš„ç½‘ç»œæ¡ä»¶æµ‹è¯•ä¸­æ–­åŠŸèƒ½

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

1. **æµå¼è¾“å‡ºå¡é¡¿**
   - æ£€æŸ¥ç½‘ç»œè¿æ¥
   - ä¼˜åŒ– DOM æ“ä½œé¢‘ç‡
   - å‡å°‘ä¸å¿…è¦çš„è®¡ç®—

2. **ä¸­æ–­åŠŸèƒ½å¤±æ•ˆ**
   - ç¡®ä¿ AbortSignal æ­£ç¡®ä¼ é€’
   - æ£€æŸ¥æ˜¯å¦æœ‰æœªå¤„ç†çš„å¼‚æ­¥æ“ä½œ
   - éªŒè¯é”™è¯¯å¤„ç†é€»è¾‘

3. **æ ·å¼é—®é¢˜**
   - æ£€æŸ¥ CSS ä½œç”¨åŸŸ
   - ç¡®è®¤æ ·å¼ä¼˜å…ˆçº§
   - éªŒè¯å“åº”å¼è®¾è®¡åœ¨ä¸åŒå±å¹•å°ºå¯¸ä¸‹çš„è¡¨ç°

## éƒ¨ç½²ä¸ä¼˜åŒ–

### æ€§èƒ½ä¼˜åŒ–

1. **è™šæ‹Ÿæ»šåŠ¨**: å¯¹äºå¤§é‡æ¶ˆæ¯ï¼Œè€ƒè™‘ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨æŠ€æœ¯
2. **æ‡’åŠ è½½**: å¯¹å›¾ç‰‡ç­‰èµ„æºå®ç°æ‡’åŠ è½½
3. **ç¼“å­˜ç­–ç•¥**: åˆç†ä½¿ç”¨æµè§ˆå™¨ç¼“å­˜
4. **ä»£ç åˆ†å‰²**: å¯¹å¤§å‹åº”ç”¨è¿›è¡Œä»£ç åˆ†å‰²

### å®‰å…¨è€ƒè™‘

1. **è¾“å…¥éªŒè¯**: å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œä¸¥æ ¼éªŒè¯
2. **XSS é˜²æŠ¤**: å¯¹å±•ç¤ºå†…å®¹è¿›è¡Œè½¬ä¹‰å¤„ç†
3. **API å¯†é’¥ä¿æŠ¤**: é¿å…å°†æ•æ„Ÿä¿¡æ¯æš´éœ²åœ¨å®¢æˆ·ç«¯

### å¯è®¿é—®æ€§ä¼˜åŒ–

1. **é”®ç›˜å¯¼èˆª**: ç¡®ä¿æ‰€æœ‰åŠŸèƒ½éƒ½å¯ä»¥é€šè¿‡é”®ç›˜æ“ä½œ
2. **å±å¹•é˜…è¯»å™¨æ”¯æŒ**: æ·»åŠ é€‚å½“çš„ ARIA æ ‡ç­¾
3. **å¯¹æ¯”åº¦æ£€æŸ¥**: ç¡®ä¿æ–‡æœ¬ä¸èƒŒæ™¯æœ‰è¶³å¤Ÿçš„å¯¹æ¯”åº¦

é€šè¿‡ä»¥ä¸Šè¯¦ç»†çš„æ­¥éª¤å’Œè¯´æ˜ï¼Œæ‚¨å¯ä»¥å®Œæ•´åœ°å®ç°ä¸€ä¸ªåŠŸèƒ½ä¸°å¯Œçš„èŠå¤©ç•Œé¢ã€‚æ¯ä¸ªéƒ¨åˆ†éƒ½æä¾›äº†è¶³å¤Ÿçš„ç»†èŠ‚ï¼Œè®©æ‚¨èƒ½å¤Ÿç†è§£å®ç°åŸç†å¹¶æ ¹æ®è‡ªå·±çš„éœ€æ±‚è¿›è¡Œå®šåˆ¶ã€‚